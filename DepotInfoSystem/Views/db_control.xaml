<Page x:Class="DepotInfoSystem.db_control"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="800"
      Title="db_control">

    <Page.Resources>

        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#B22222"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="5,0,0,0"/>
            <Setter Property="Width" Value="90"/>
            <Setter Property="Height" Value="35"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" RecognizesAccessKey="True"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#7F0000"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#4B0000"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#DDD"/>
                                <Setter Property="Foreground" Value="#999"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SearchTextBoxStyle" TargetType="TextBox">
            <Setter Property="Height" Value="30"/>
            <Setter Property="Padding" Value="6,2"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#666"/>
            <Setter Property="Background" Value="#F7F7F7"/>
            <Setter Property="BorderBrush" Value="#B22222"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="10,0,0,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ScrollViewer x:Name="PART_ContentHost"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Label" x:Key="FilterLabelStyle">
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Margin" Value="0,5,0,2"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>

        <Style TargetType="TextBlock" x:Key="FilterTextBlockStyle">
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Margin" Value="0,5,0,2"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>

        <Style TargetType="ComboBox" x:Key="FilterComboBoxStyle">
            <Setter Property="Height" Value="30"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#B22222"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="0,2,0,5"/>
            <Setter Property="Padding" Value="6,2"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <Style TargetType="ScrollViewer" x:Key="FilterScrollViewerStyle">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#B22222"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="4"/>
            <Setter Property="Margin" Value="0,5,0,0"/>
        </Style>
    </Page.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="220"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0" Margin="5" Orientation="Vertical">
            <Border Background="#FFF0F0F0" Padding="8" CornerRadius="6" Margin="0,5,0,0">
                <Border.Effect>
                    <DropShadowEffect Color="#888" ShadowDepth="2" BlurRadius="4" Opacity="0.15"/>
                </Border.Effect>
                <StackPanel x:Name="TrainsFilters" Orientation="Vertical" Visibility="Collapsed">
                    <Label Content="Manufacture year from:" Style="{StaticResource FilterLabelStyle}"/>
                    <StackPanel Orientation="Horizontal">
                        <TextBox x:Name="filter_TrainManufactureYearFrom" Width="60" TextChanged="TrainFilter_Changed" />
                        <Label Content="to:" Style="{StaticResource FilterLabelStyle}"/>
                        <TextBox x:Name="filter_TrainManufactureYearTo" Width="60" TextChanged="TrainFilter_Changed" />
                    </StackPanel>

                    <Label Content="Mileage up to (km):" Style="{StaticResource FilterLabelStyle}"/>
                    <TextBox x:Name="filter_TrainMileageUpTo" Width="100" TextChanged="TrainFilter_Changed" />

                    <Label Content="Status:" Style="{StaticResource FilterLabelStyle}"/>
                    <ComboBox x:Name="filter_TrainStatus" SelectedIndex="0" SelectionChanged="TrainFilter_Changed" Style="{StaticResource FilterComboBoxStyle}">
                        <ComboBoxItem Content="All"/>
                        <ComboBoxItem Content="In Operation"/>
                        <ComboBoxItem Content="Needs Decommissioning"/>
                        <ComboBoxItem Content="Needs Repair"/>
                        <ComboBoxItem Content="Under Repair"/>
                        <ComboBoxItem Content="Decommissioned"/>
                    </ComboBox>
                    <Button Content="Clear filters" Click="ClearTrainFilters_Click" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>

            <Border Background="#FFF0F0F0" Padding="8" CornerRadius="6" Margin="0,5,0,0">
                <Border.Effect>
                    <DropShadowEffect Color="#888" ShadowDepth="2" BlurRadius="4" Opacity="0.15"/>
                </Border.Effect>
                <StackPanel x:Name="EmployeeFilters" Orientation="Vertical" Visibility="Collapsed">
                    <Label Content="Speciality:" Style="{StaticResource FilterLabelStyle}"/>
                    <ComboBox x:Name="filter_EmployeeSpeciality" SelectedIndex="0" SelectionChanged="EmployeeFilter_Changed" Style="{StaticResource FilterComboBoxStyle}">
                        <ComboBoxItem Content="All"/>
                    </ComboBox>
                    <Button Content="Clear filters" Click="ClearEmployeeFilters_Click" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>

            <Border Background="#FFF0F0F0" Padding="8" CornerRadius="6" Margin="0,5,0,0">
                <Border.Effect>
                    <DropShadowEffect Color="#888" ShadowDepth="2" BlurRadius="4" Opacity="0.15"/>
                </Border.Effect>
                <StackPanel x:Name="RepairsFilters" Orientation="Vertical" Visibility="Collapsed">
                    <Label Content="Description/Status:" Style="{StaticResource FilterLabelStyle}"/>
                    <TextBox x:Name="filter_RepairDescriptionStatus" Width="150" TextChanged="RepairFilter_Changed"/>
                    <Label Content="Train (number):" Style="{StaticResource FilterLabelStyle}"/>
                    <ComboBox x:Name="filter_RepairTrainNumber" SelectedIndex="0" SelectionChanged="RepairFilter_Changed" Style="{StaticResource FilterComboBoxStyle}">
                        <ComboBoxItem Content="All"/>
                    </ComboBox>
                    <Label Content="Repair type:" Style="{StaticResource FilterLabelStyle}"/>
                    <ComboBox x:Name="filter_RepairType" SelectedIndex="0" SelectionChanged="RepairFilter_Changed" Style="{StaticResource FilterComboBoxStyle}">
                        <ComboBoxItem Content="All"/>
                    </ComboBox>
                    <Label Content="User (login):" Style="{StaticResource FilterLabelStyle}"/>
                    <ComboBox x:Name="filter_RepairUser" SelectedIndex="0" SelectionChanged="RepairFilter_Changed" Style="{StaticResource FilterComboBoxStyle}">
                        <ComboBoxItem Content="All"/>
                    </ComboBox>
                    <Label Content="Repair status:" Style="{StaticResource FilterLabelStyle}"/>
                    <ComboBox x:Name="filter_RepairStatus" SelectedIndex="0" SelectionChanged="RepairFilter_Changed" Style="{StaticResource FilterComboBoxStyle}">
                        <ComboBoxItem Content="All"/>
                        <ComboBoxItem Content="In Progress"/>
                        <ComboBoxItem Content="Completed"/>
                        <ComboBoxItem Content="Cancelled"/>
                    </ComboBox>
                    <Button Content="Clear filters" Click="ClearRepairsFilters_Click" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>

            <Border Background="#FFF0F0F0" Padding="8" CornerRadius="6" Margin="0,5,0,0">
                <Border.Effect>
                    <DropShadowEffect Color="#888" ShadowDepth="2" BlurRadius="4" Opacity="0.15"/>
                </Border.Effect>
                <StackPanel x:Name="WarehouseFilters" Orientation="Vertical" Visibility="Collapsed">
                    <TextBlock Text="Search (Name, ID, Repair ID):" Margin="0,0,0,5" Style="{StaticResource FilterTextBlockStyle}"/>
                    <TextBox x:Name="filter_SpareSearch" TextChanged="SpareFilter_Changed" Margin="0,0,0,5"/>

                    <TextBlock Text="Cost range:" Margin="0,5,0,0" Style="{StaticResource FilterTextBlockStyle}"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="5"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="filter_SpareCostFrom" Grid.Column="0" TextChanged="SpareFilter_Changed" Tag="From" />
                        <TextBlock Text="-" Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center" Style="{StaticResource FilterTextBlockStyle}"/>
                        <TextBox x:Name="filter_SpareCostTo" Grid.Column="2" TextChanged="SpareFilter_Changed" Tag="To" />
                    </Grid>

                    <TextBlock Text="Quantity range:" Margin="0,10,0,0" Style="{StaticResource FilterTextBlockStyle}"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="5"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="filter_SpareCountFrom" Grid.Column="0" TextChanged="SpareFilter_Changed" Tag="From" />
                        <TextBlock Text="-" Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center" Style="{StaticResource FilterTextBlockStyle}"/>
                        <TextBox x:Name="filter_SpareCountTo" Grid.Column="2" TextChanged="SpareFilter_Changed" Tag="To" />
                    </Grid>

                    <Button Content="Clear filters" Click="ClearSparesFilters_Click" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>

            <Border Background="#FFF0F0F0" Padding="8" CornerRadius="6" Margin="0,5,0,0">
                <Border.Effect>
                    <DropShadowEffect Color="#888" ShadowDepth="2" BlurRadius="4" Opacity="0.15"/>
                </Border.Effect>
                <StackPanel x:Name="RolesFilters" Orientation="Vertical" Visibility="Collapsed">
                    <TextBlock Text="Permission filter (multi-level):" Margin="0,5,0,0" Style="{StaticResource FilterTextBlockStyle}"/>
                    <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto" Style="{StaticResource FilterScrollViewerStyle}">
                        <ListBox x:Name="filter_RolePermissionsList" SelectionMode="Multiple" SelectionChanged="RoleFilter_Changed" />
                    </ScrollViewer>
                    <Button Content="Clear filters" Click="ClearRolesFilters_Click" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>

            <Border Background="#FFF0F0F0" Padding="8" CornerRadius="6" Margin="0,5,0,0">
                <Border.Effect>
                    <DropShadowEffect Color="#888" ShadowDepth="2" BlurRadius="4" Opacity="0.15"/>
                </Border.Effect>
                <StackPanel x:Name="UsersFilters" Orientation="Vertical" Visibility="Collapsed">
                    <Label Content="Role:" Style="{StaticResource FilterLabelStyle}"/>
                    <ComboBox x:Name="filter_UserRole" SelectedIndex="0" SelectionChanged="UserFilter_Changed" Style="{StaticResource FilterComboBoxStyle}">
                        <ComboBoxItem Content="All"/>
                    </ComboBox>
                    <Button Content="Clear filters" Click="ClearUsersFilters_Click" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>

            <Border Background="#FFF0F0F0" Padding="8" CornerRadius="6" Margin="0,5,0,0">
                <Border.Effect>
                    <DropShadowEffect Color="#888" ShadowDepth="2" BlurRadius="4" Opacity="0.15"/>
                </Border.Effect>
                <StackPanel x:Name="BrigadesFilters" Orientation="Vertical" Visibility="Collapsed">
                    <Label Content="Employee ID:" Style="{StaticResource FilterLabelStyle}"/>
                    <TextBox x:Name="filter_BrigadeEmployeeID" Width="80" TextChanged="BrigadeFilter_Changed"/>
                    <Label Content="Repair ID:" Style="{StaticResource FilterLabelStyle}"/>
                    <TextBox x:Name="filter_BrigadeRepairID" Width="80" TextChanged="BrigadeFilter_Changed"/>
                    <Button Content="Clear filters" Click="ClearBrigadesFilters_Click" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>
        </StackPanel>

        <StackPanel Grid.Column="1">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,10">
                <Button x:Name="btn_add" Content="Add" Style="{StaticResource ActionButtonStyle}" Click="btn_add_Click"/>
                <Button x:Name="btn_edit" Content="Edit" Style="{StaticResource ActionButtonStyle}" Click="btn_edit_Click"/>
                <Button x:Name="btn_delete" Content="Delete" Style="{StaticResource ActionButtonStyle}" Click="btn_delete_Click"/>
                <TextBox x:Name="txtSearch" Style="{StaticResource SearchTextBoxStyle}" 
                 Text="Search..." Width="465" 
                 TextChanged="txtSearch_TextChanged" GotFocus="txtSearch_GotFocus" LostFocus="txtSearch_LostFocus"/>

                <Button x:Name="btn_swap" Content="🗂/🔠" Style="{StaticResource ActionButtonStyle}" Click="btn_swap_Click"/>
            </StackPanel>

            <StackPanel Grid.Row="1">


                <Border BorderBrush="#B22222" BorderThickness="1" CornerRadius="8" Background="White" Padding="10">
                    <Grid>
                        <ListBox x:Name="list" Visibility="Visible" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                            <ListBox.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ListBox.ItemsPanel>
                        </ListBox>

                        <DataGrid x:Name="dataGrid" Visibility="Collapsed"
                          AutoGenerateColumns="False" IsReadOnly="True"
                          SelectionMode="Single" SelectionUnit="FullRow" />
                    </Grid>
                </Border>
            </StackPanel>
        </StackPanel>
    </Grid>
</Page>